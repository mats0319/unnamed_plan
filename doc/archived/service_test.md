# 业务服务测试

## 介绍

为业务服务编写测试，可以在改动后，快速测试相关内容正确性

## 设计

构造需要测试的服务实例，使用真实数据库连接（尽量不要直接使用正式数据库，哪怕我们在表名上做了区分），mock跨服务调用

1. 准备阶段：
    1. 创建测试用数据库表
        1. 测试表表名由**正式表名+时间戳**构成
    2. 准备测试数据，包含数据库记录与请求参数
    3. 构造服务实例
    4. mock跨服务调用
2. 测试服务功能（以下步骤对应一个功能）：
    1. 构造请求参数
        1. 一些非常规的请求参数，例如上传文件时的文件原文，通过真实请求获得，即真实上传一个文件，然后拿到它的内容
    2. 调用请求方法
    3. 检查执行结果
        1. 读请求只需要验证请求方法返回值
        2. 写请求需要验证数据库记录，可能需要新的数据库查询语句，拟单独写在测试代码里
3. 测试结束后：
    1. 若测试全部通过，则删除测试用数据库表

## 优化

1. 测试的配置怎么办，在实装配置中心后，其他服务通过配置中心获取配置，配置的改变很难实时反馈到测试配置上
    1. 拟为配置中心添加**导出配置**功能
2. 注意：如果想要更换测试代码使用的DBMS，则需要额外编写相应DBMS的测试用sql
