# 开发笔记

## 第一个版本

> 纯前端项目

1. 主页+子页面路由，主要处理域名和服务器的问题
2. 添加移动端设备访问屏蔽，配置nginx

## 第二个版本

> 引入后端

1. 添加登录功能，借此引入网站公开页面后端

## 第三个版本

> 引入后台

1. 通过用户系统，引入后台程序，后续新功能模块从后台往前台写

至此，项目基本框架搭建完成

## 第四个版本

> 添加云文件系统

1. 添加云文件系统，提供云文件保存、修改、预览、下载等功能
2. 编写前台程序移动端界面(public_mobile)，开放查询模块，支持查询自己上传的文件

## 第五个版本

> 添加随想系统

1. 添加随想系统，记录自己生活中的想法和体会，经一事，长一智

## 第六个版本

> 后台使用微服务架构，代码扩展

1. 后台调整为微服务架构，所有请求统一发往API网关
2. 增加API网关，统一处理所有的请求，其他服务不对外暴露
3. 引入数据访问层，支持快速替换DBMS
4. 引入http多处登录限制，限制一个用户在多终端登录
5. 引入日志模块
6. 引入命令行参数解析模块

## 第七个版本

> 添加任务系统

1. 添加任务系统，记录和管理自己需要学习的知识

## 第八个版本

> 结构调整与代码优化

1. 引入make
    1. 目前把make当做所有编译、运行命令的目录来用
2. 引入服务测试
3. 引入数据库乐观锁
4. 引入go工具：
    1. 格式化代码(go fmt)
    2. 检测代码中的*可疑结构*(go vet)
5. 引入核心服务，包含配置中心和服务注册中心功能
6. 删除任务系统
7. 重写前端页面，使用vue3，合并原admin_web与public_web，删除原public_mobile
8. 删除笔记系统

优化：

1. 开发模式下，日志同时输出到日志文件和控制台
2. 取消使用grpc带给go代码的error来表示程序执行错误，在proto文件中定义统一的错误类型
    1. 目的：区分rpc连接错误与服务执行错误
3. 在业务服务中，增加错误日志
    1. 接上一条，反正要改动所有实现函数，就一起改了，为调用链追踪做准备
4. 将初始化函数中的`os.exit(-1)`，调整为返回`error`。现在函数初始化失败，不会继续执行后续功能了
    1. 历史遗留问题，曾经使用无返回值的`init()`函数，需要原地退出，但调整了初始化的执行时间（从init阶段调整为main阶段），也该使用相应的编码风格
5. 网关层核心代码与附加功能解耦，将附加功能（多登限制模块）做成插件
6. nginx反向代理规则，统一各来源的请求url前缀为：`https://117.50.177.201/api`
7. 优化项目部署流程，将服务升级过程编写成脚本`upgrade_services.sh`
8. 前端退出登录时，清空登录信息
9. 调整http请求结构与规则
    1. 使用pb结构中的error
    2. 多登限制信息从http response data移动到header(user id & token)，调整文档
    3. http返回结构调整，暂时依旧使用data封装一层返回结构

## 计划开发内容

> 针对本节内容，设计草稿中会记录一些想法

引入新的模块/功能：

1. 性能监控
2. 调用链追踪
3. 限流、熔断、降级等功能

前端：

后端：

1. 阅读优秀的代码，学习和吸收优秀的设计与功能模块，计划阅读的几个库：
    1. gin
    2. zap
    3. github.com/flipped-aurora/gin-vue-admin gin-vue基础平台，据说其中的组件设计较为优秀
    4. github.com/zhenghaoz/gorse go语言推荐系统
    5. github.com/andydotxyz/chess go GUI开发
    6. go zero 一个微服务框架
    7. uber-go/fx 依赖注入框架
2. pb生成的go代码，默认包含tag：json:"omitempty"，导致请求返回结果可能不包含指定字段
    1. [x] 前端添加判断：字段是否存在
    2. [ ] 修改pb生成go代码规则：不添加该tag

其他：

1. makefile添加前端build脚本（powershell），包含build、dist文件夹移动
2. 想一想什么时候用`service`，什么时候用`server`，然后把命名过一遍
